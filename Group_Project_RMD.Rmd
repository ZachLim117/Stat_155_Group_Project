---
title: "Final Project"
author: "Zachary Lim, Mey So, Jason Tram"
output:
  html_document:
    df_print: paged
---

```{r, message=FALSE, warning=FALSE}
library(moderndive)
library(skimr)
library(GGally)
library(openintro)
library(broom) 
library(tidyverse)
library(alr4)
library(ggmosaic)
library(ggridges)
library(fivethirtyeight)
```

## Hate Crimes

Hate crimes is defined as "any actions of prejudice based on race, religion, sexual orientation, disability, or ethnicity". In this investigation we will use the package [hate_crimes](https://fivethirtyeight.com/features/higher-rates-of-hate-crimes-are-tied-to-income-inequality/) from the *fivethirtyeight* library. The data looks at how hate crimes varies by states and how might different variables be accountable for this crimes level. 

The data was collected from 2 institutions: The Southern Poverty Law Center (Nov 9-18, 2016) and the FBI (2010-2015). The motivation of this data collection was due to the high report of hate incidents following the 2016 election of President Donald Trump. The SPLC form collect their data based on medias accounts and people's self-reports, while the FBI collect their based on  reports from their agencies. 

Research Question: To what extend does income inequality affect the level of hate crimes reported across the United State? 

The objective of this research is to further understand the relationship between the reported hate crimes and the median household income of the state, to perform statistical analysis to confirm or denied our prediction, and to see whether this result is consistent across the two institutions. 

## Look into data

```{r}
hc<-hate_crimes[-c(9),][-c(11),] #observation 9 (DC) produced to much interference when combined with other data states. Also doesn't count as a state, so thought it would be best to remove it's data from data wrangling. Observation 11 (Hawaii) does not inclued any data on Hate crimes Splc/FBI thus was removed from Data wrangling

hc
```

```{r} 
hc %>% 
  ggplot(aes(x=median_house_inc, y=hate_crimes_per_100k_splc))+ #Southern Poverty Law Center
  geom_text(aes(label=state_abbrev),
            alpha=0.7,size=2.5) +
  geom_smooth(se = FALSE, method = "lm")

```
This graph above shows the relationship between the median household income in 2016 and the hate crimes reports from SPLC. There seems to be a positive correlation between the median household income and the hate crimes reported. The higher median household income in the state, the more hate crimes reported. 

```{r}
hc %>% 
  ggplot(aes(x=median_house_inc, y=avg_hatecrimes_per_100k_fbi))+ #FBI 
  geom_text(aes(label=state_abbrev),
            alpha=0.7,size=2.5) +
  geom_smooth(se = FALSE, method = "lm")
```
The graph above shows similar relationship between the median household income and the average hate crimes reported to the FBI. Although there is still a positive correlation between the median income and the average hate crimes, we do see that the average hate crimes reported for many states are not consistent with the level of hate crimes reported by the SPLC. 


```{r} 
hc %>% 
  ggplot(aes(x=share_non_white, y=hate_crimes_per_100k_splc))+ #Southern Poverty Law Center
  geom_text(aes(label=state_abbrev),
            alpha=0.7,size=2.5) +
  geom_smooth(se = FALSE, method = "lm")

```
The graph above shows the relationship between the share of state population that is not white and the hate crimes reported to the SPLC. This shows a negative correlation meaning the more non-white population there is in the state, the lower hate crimes reported. 


```{r}
hc %>% 
  ggplot(aes(x=share_non_white, y=avg_hatecrimes_per_100k_fbi))+ #FBI 
  geom_text(aes(label=state_abbrev),
            alpha=0.7,size=2.5) +
  geom_smooth(se = FALSE, method = "lm")
```

The graph above shows similar relationship from the previous graph, showing the relationship between the share of the state population that are not white and the average hate crimes reported to the FBI. The result is fairly consistent with the data from the SPLC and it shows that the more non-white population in the state correlate with the lower average hate crimes reported. 

##Fiited Models

```{r}
lm.income.fbi <- lm(avg_hatecrimes_per_100k_fbi ~ median_house_inc,
                  data = hc)
tidy(lm.income.fbi)
```
This model explains the correlation between average hate crimes and median household income. The median_house_inc variable explains how much the predicted rates of hate crimes would increase based on increase in household income. 

```{r}
lm.white.hate <- lm(avg_hatecrimes_per_100k_fbi ~ median_house_inc + share_non_white,
data = hc)   
tidy(lm.white.hate)
```
_This model adds an additional variable, the share of non whites, to the model before, but does not include interaction between household income and share of nonwhite people affecting rates of hate crimes. An interesting note is that there is a decrease in hate crimes modeled by increasing the share of non white people._

```{r}
lm.interaction <- lm(avg_hatecrimes_per_100k_fbi ~ median_house_inc * share_non_white,
data = hc)
tidy(lm.interaction)
```
_Here the interaction between median household income and share of non whites is added. An interesting note is that median household income by itself does not cause a super large increase in predicted hate crimes, and increasing non whites causes a significant decrease in predicted hate crimes. However, adding them together causes a small overall increase in predicted hate crimes._


## Hypothesis testing

```{r}
get_regression_table(lm.white.hate) %>% 
  filter(term == "share_non_white") %>% 
  select(term, estimate, lower_ci, upper_ci)
```


```{r}
set.seed(111)

whiteHate_200times <- 
  rep_sample_n(hc, 
               size = 51, 
               reps = 200, 
               replace = TRUE) %>% 
  group_by(replicate) %>%     
  do(lm(avg_hatecrimes_per_100k_fbi ~ median_house_inc + share_non_white, data=.) %>% tidy()) %>% 
  filter(term == "share_non_white")  

whiteHate_200times %>% 
  ungroup() %>% 
  summarize(mean_est = mean(estimate),
            sd_est = sd(estimate),
            lower_ci = mean_est - 2*sd_est,
            upper_ci = mean_est + 2*sd_est)
```



What to include: 

(@) At least 2 models. Explain why you chose to fit these models and interpret the coefficients of the model. What do they mean in the context of your research question? 

(@) Make some inferences, using either hypothesis testing or confidence intervals. What did you learn?

(@) Discuss next steps.

